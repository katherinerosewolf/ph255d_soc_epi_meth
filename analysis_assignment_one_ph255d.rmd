---
title: "Descriptive Analysis of a Multilevel Data Set"
author: "Katherine Wolf"
date: "February 20, 2020"
output:
    pdf_document:
       includes:
         in_header: preamble-latex.tex
    html_document:
       includes:
         before_body: preamble-mathjax.tex
    latex_engine: xelatex
mainfont: Calibri
monofont: Lucida Console
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE)

```


```{r my code}

```



```{r code from assignment, eval=FALSE, include=FALSE}

# # load packages used in this assignment
# # only need to install packages once
# install.packages("dplyr") 
# install.packages("ggplot2")
# install.packages("nnet")

# need to call the libraries every time you begin a new R session
library(dplyr)
library(ggplot2)
library(nnet)

# read in data – suppose the file dataset.csv contains continuous variables var1 and var2, and a binary variable outcome
df <- read.csv("c:/dataset.csv")

# create a categorical variable from a continuous variable 
df$catvar1 <- df$var1
df$catvar1 <- ifelse(df$catvar1<=500,0,ifelse(df$catvar1>500,1,NA))

# describe variables
summary(df$var1)
table(df$var1)
hist(df$var1)

with(df, table(var1,var2))
with(df, table(var1,var2, exclude=NULL))

df %>%  group_by(catvar1) %>% summarise(mean_outcome = mean(outcome))


# bivariable relations

# to do a Pearson's chi-squared test 
x2 <- chisq.test(df$var1, df$var2)

# to see the results of the test
x2 

# to see the table of observed
x2$observed

# to see the percents by row 
prop.table(x2$observed, 1) 

# to see the percents by column
prop.table(x2$observed, 2)

# calculate correlation between variables 
cor.test(df$var1, df$var2)

# summarize relationship between variables in a plot with a lowess line 
ggplot(df) + geom_point(aes(x=var1, y=outcome))  + 
  geom_line(aes(x=var1, y=predict(loess(outcome~var1)))) + theme_bw()


```


# Question One

## State the point estimate and 95% confidence interval (CI) for the estimated risk difference (RD) and risk ratio (RR) for this analysis. (20 points)

The point estimate for the estimated risk (cumulative incidence) difference derived using model-based standardization,[^1] which compares the modeled cumulative incidence of hypertension over the study period in a hypothetical study population in which everyone is obese to that in a hypothetical study population in which everyone is "ideal" weight, is `r round(stdized.rd, 3)` (95% CI: `r round(ci.rd.bca$bca[4], 3)`, `r round(ci.rd.bca$bca[5], 3)`).[^2] 

The point estimate for the estimated risk (cumulative incidence) ratio (RR) derived using model-based standardization, which compares the modeled cumulative incidence of hypertension over the study period in a hypothetical study population in which everyone is obese to that in a hypothetical study population in which everyone is "ideal" weight, is `r round(stdized.rr, 3)` (95% CI: `r round(ci.rr.bca$bca[4], 3)`, `r round(ci.rr.bca$bca[5], 3)`).

[^1]: Greenland S. Model-based Estimation of Relative Risks and Other Epidemiologic Measures in Studies of Common Outcomes and in Case-Control Studies. Am J Epidemiol 2004;160(4):301–5. doi:10.1093/aje/kwh221.

[^2]: I calculated the CIs around the model-standardized point estimates of the RD and the RR using the bias-corrected and accelerated method in the `boot` R package, which corrects for both (1) the potential difference between the mean of all the bootstrap-sample-derived point estimates used to construct the 95% CI and the point estimate calculated from the original dataset, caused by asymmetry in the sampling distribution (the "bias-corrected" piece), as well as (2) changes in skewness in the distribution that vary with the value of the estimated parameter (the "accelerated" piece). See Carpenter J, Bithell J. Bootstrap confidence intervals: when, which, what? A practical guide for medical statisticians. Statistics in Medicine 2000;19(9):1141–1164. doi:10.1002/(SICI)1097-0258(20000515)19:9<1141::AID-SIM479>3.0.CO;2-F. (Page 1154.)

\pagebreak

# Question Two

## Turn in the density plots for the risk difference (RD) and risk ratio (RR) measures. Briefly describe the pattern that you see. Does the pattern seem to indicate that the sampling distribution of the RD and RR are approximately normal? (10 points)

```{r}

par(mfrow=c(3,1))
plot(density(rd.samples), main = "Bootstrapped Samples of Risk Difference")
plot(density(rr.samples), main = "Bootstrapped Samples of Risk Ratio")
plot(density(log(rr.samples)), main = "Bootstrapped Samples of Log Risk Ratio")
par(mfrow=c(1,1))

```


```{r ref.label=knitr::all_labels(), echo = T, eval = F}

```

